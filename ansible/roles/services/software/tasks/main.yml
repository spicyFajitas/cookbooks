---
- name: Run apt update
  ansible.builtin.apt:
    update_cache: yes

- name: Install required packages
  ansible.builtin.apt:
    name: "{{ item }}"
    state: present
  loop: "{{ package_list }}"

- name: Enable and start fail2ban
  ansible.builtin.service:
    name: "fail2ban"
    state: started
    enabled: true

- name: Run apt upgrade
  ansible.builtin.apt:
    upgrade: yes

- name: Restart services if needed
  # https://www.captainark.net/2016/01/31/debian-updates-with-ansible/
  shell: needrestart -blra
